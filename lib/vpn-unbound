#!/bin/sh

unbound_conf=/var/lib/unbound/unbound-resolvconf.conf

NL="
"

if [ $2 = vpn-up ]; then
#VPN_IP4_NAMESERVERS=10.0.0.104 10.0.0.103
#VPN_IP4_DOMAINS=ot.tools dev.analyticalsystems.com.au sharepoint.booking.com compute.internal otenv.com otsql.opentable.com net.opentable.com qasql.opentable.com otcorp.opentable.com

  newconf="# Generated by NM dispatcher script vpn-unbound$NL"

  for d in ${VPN_IP4_DOMAINS}; do
    newconf="$newconf${NL}forward-zone:$NL	name: \"$d\"$NL"

    for ns in ${VPN_IP4_NAMESERVERS}; do
      newconf="$newconf	forward-addr: ${ns%%,*}$NL"
    done
  done

	printf %s "$newconf" >"$unbound_conf"
fi

if [ $2 = vpn-down ]; then
  echo "# Generated by NM dispatcher script vpn-unbound" > "$unbound_conf"
fi
